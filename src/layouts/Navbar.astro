---
import { Image } from 'astro:assets';
import MobileNavMenu from '~/components/MobileNavMenu.astro';
import NavigationLinks from '~/components/NavigationLinks.astro';
import ThemeSwitchButton from '~/components/ThemeSwitchButton.astro';
import logo from '~/assets/logo.png';
---

<nav
  x-data='navbar'
  class='navbar sticky top-0 z-10 mb-12 mt-20 flex flex-row items-start py-4 pl-2 pr-4 md:-mx-[28px] md:px-5'
>
  <MobileNavMenu />

  <div
    class='backdrop absolute left-[-8px] right-[-8px] top-0 h-20 min-w-full backdrop-blur md:-mx-[28px]'
  >
  </div>

  <div
    class='img-container z-10 flex min-w-full flex-row justify-between space-x-0'
  >
    <a href='/' class='flex flex-row items-center'>
      <Image
        src={logo}
        width={96}
        height={96}
        quality={75}
        densities={[1, 2]}
        class='mr-4 w-12'
        alt='Coding Kittens website logo'
        loading='eager'
      />

      <div class='flex flex-col'>
        <p
          class='m-0 font-display text-2xl font-bold text-primary-600 dark:text-2xl dark:text-primary-100 sm:text-2xl sm:dark:text-2xl'
        >
          Coding Kittens
        </p>
        <p class='subtle m-0'>Curiosity Didn&apos;t Kill The Cat</p>
      </div>
    </a>

    <div class='flex flex-row-reverse gap-6 sm:flex-row'>
      <NavigationLinks />
      <ThemeSwitchButton />
    </div>
  </div>
</nav>
<style>
  @supports (animation-timeline: scroll()) {
    .navbar {
      --navbar-shrink: 0;

      animation: shrink;
      animation-timeline: scroll(nearest block);
      animation-timing-function: ease;
    }
  }

  .navbar .img-container {
    transition: transform 0.3s ease;
    will-change: transform;
    transform: translateY(calc(0px - var(--navbar-shrink) * 12px));
  }
  .navbar .backdrop {
    transition: transform 0.3s ease;
    will-change: transform;
    transform: translateY(calc(0px - var(--navbar-shrink) * 24px));
  }

  .navbar img {
    transition: transform 0.3s ease;
    will-change: transform;
    transform: scale(calc(1 - var(--navbar-shrink) * 0.2));
  }

  .navbar h1,
  .navbar p {
    transition: opacity 0.3s ease;
    opacity: calc(1 - var(--navbar-shrink));
  }

  @keyframes shrink {
    0% {
      --navbar-shrink: 0;
    }
    10%,
    100% {
      --navbar-shrink: 1;
    }
  }
</style>

<script type='module'>
  const threshold = 500; // Adjust this threshold as needed

  function handleScroll() {
    const navbar = document.querySelector('.navbar');

    console.log('attahcing', navbar);
    if (!navbar) {
      return;
    }

    const scrollY = window.scrollY || window.pageYOffset;

    if (scrollY > threshold) {
      navbar.style.setProperty('--navbar-shrink', '1');
    } else {
      navbar.style.setProperty('--navbar-shrink', '0');
    }
  }

  if (!CSS.supports('animation-timeline: scroll()')) {
    window.addEventListener('scroll', handleScroll);
  }
</script>
