---
title: 'C√≥mo utilic√© nuevas funcionalidades de CSS para mejorar la UX de la barra de navegaci√≥n de Coding Kittens'
pubDate: 2024-01-20
thumbnail: ~/assets/thumbnails/post_2.jpeg
subtitle: 'Si G√°ndalf programase con CSS ser√≠a as√≠'
shortDescription: >
  Un ejemplo pr√°ctico de c√≥mo utilizar "Scroll-Driven Animations" para mejorar tu web.
---

import Callout from '~/components/ui/Callout.astro';
import Highlight from '~/components/ui/Highlight.astro';
import ImageCard from '~/components/ui/ImageCard.astro';
import Pill from '~/components/Pill.astro';
import { CodeSandbox } from '~/components/react/Sandpack';
import { getFiles } from '~/examples/navigation-shrink';
import cardImage from "~/assets/images/post_2_1.png";

<Callout title='Atenci√≥! Funcionalitat experimental' type='warning'>
  En el momento de escribir esta entrada la funcionalidad de **`animation-timeline:scroll`** todav√≠a es experimental.
  Aseg√∫rate de que a√±ades una alternativa compatible. Puedes consultar la lista de compatibilidad en  [caniuse.com](https://caniuse.com/mdn-css_properties_animation-timeline_scroll)
</Callout>

## Una poco de contexto

He trabajado en muchas iteraciones de la barra de navegaci√≥n de esta web para conseguir un estilo que me dejara satisfecho. Quer√≠a un logo que destacase y una navegaci√≥n siempre visible ‚Äì especialmente en m√≥vil ‚Äì para que la persona leyendo esta entrada pudiera interactuar con ella en todo momento.

Por este motivo decid√≠ que la barra de navegaci√≥n deb√≠a adherirse a la parte superior cuando el usuario se desplazara y a√±ad√≠ el logo con el nombre de la web y el eslogan.

Precioso, ‚Äî desde mi punto de vista ‚Äî por fin estaba contento con el resultado.


```bash
git commit -m "implement absolute perfect non-AI Navbar"
```

Despu√©s del despliegue autom√°tico, me dispongo a consultar en mi m√≥vil c√≥mo ha quedado la web. Todo parec√≠a fant√°stico hasta que empec√© a leer mi primera entrada en el blog [C√≥mo arreglar el error "Stack-Size limit" de una funci√≥n recursiva mediante iteraci√≥n en JavaScript](/blog/javascript/how-to-fix-stack-size-limit-error-of-a-recursive-function-using-iteration-in-javascript) y me di cuenta de que en mi m√≥vil diminuto con mi pantalla min√∫scula la barra de navegaci√≥n ocupaba gran parte del espacio de lectura.

En aquel entonces ten√≠a un m√≥vil de 4,7 pulgadas as√≠ que normalmente no ten√≠a mucho espacio para leer.

Mira.

<ImageCard
  id='image01'
  src={cardImage}
  alt='La web de Coding Kittens con una barra de navegaci√≥n ocupando un porcentaje muy alto de la pantalla'
  width={640}
  height={1142}
  quality={80}
  caption={{
    text: 'La barra de navegaci√≥n ocupa un porcentaje muy alto de la pantalla en un dispositivo peque√±o',
  }}
/>

Siento algo similar a la claustrofobia cuando tengo un texto contenido en un espacio tan reducido.

Sin embargo, no quer√≠a que la barra de navegaci√≥n destacase menos <Highlight>‚Äî la primera impresi√≥n cuando llegas a una web es la m√°s importante ‚Äî</Highlight> pero no pod√≠a dejarlo as√≠.

Luego pens√©... "Vale, si me molesta cuando me desplazo hacia abajo para leer la entrada del blog entonces... ¬øQue tal si hago que la barra de navegaci√≥n sea m√°s peque√±a cuando el usuario no est√° en lo m√°s alto de la p√°gina?".

Y as√≠ lo hice.

De acuerdo, despu√©s de esta peque√±a introducci√≥n y dado todo el contexto vamos a hacer un viaje al mundo del CSS y JavaScript, donde lo imposible es posible y donde hay mil maneras de llegar al mismo sitio. üîÆ

## Implementaci√≥n aburrida

Si haces una b√∫squeda r√°pida en google sobre c√≥mo encoger el men√∫ de navegaci√≥n a medida que el usuario se desplaza hacia abajo el primer resultado que te saldr√° seguramente ser√° esta p√°gina de W3schools: [How TO - Shrink Navigation Menu on Scroll](https://www.w3schools.com/howto/howto_js_navbar_shrink_scroll.asp).

Las secciones de HTML y CSS son las bases de una barra de navegaci√≥n. La parte interesante es este pedacito de JavaScript:

```js
// Cuando el usuario se desplaza 80px desde la parte superior del documento, cambiamos el tama√±o del padding y de la fuente del logo.
window.onscroll = function () {
  scrollFunction();
};

function scrollFunction() {
  if (document.body.scrollTop > 80 || document.documentElement.scrollTop > 80) {
    document.getElementById('navbar').style.padding = '30px 10px';
    document.getElementById('logo').style.fontSize = '25px';
  } else {
    document.getElementById('navbar').style.padding = '80px 10px';
    document.getElementById('logo').style.fontSize = '35px';
  }
}
```

Este c√≥digo b√°sicamente asigna una funci√≥n al evento global `onscroll` y comprueba qu√© proporci√≥n de `<body>` o del `<html>` el usuario se ha desplazado. Aplicar√° unos estilos u otros en funci√≥n de la distancia.

Esto es todo, gracias por leer esta entrada.

...

...

Ahora en serio, este intento de solucionar el problema es el m√°s simple, y probablemente una buena opci√≥n en la mayor√≠a de los casos.

El problema es que... ¬ød√≥nde est√° la gracia al hacerlo as√≠? Coding Kittens es un sitio donde me gusta experimentar y probar cosas nuevas. <Highlight>Quiero una soluci√≥n √≥ptima, extensible y basada exclusivamente en CSS</Highlight>

¬øC√≥mo te quedar√≠as si te digo que existe una manera futurista de enfocar la soluci√≥n utilizando exclusivamente CSS? Escoger√≠as la <Pill>[#unstyled p√≠ldora aburrida](#less-fun-implementation)</Pill> o la <Pill color="red">[#unstyled p√≠ldora futur√≠stica](#what-is-the-scroll-css-function-and-scrolltimeline)</Pill>?

Si sientes curiosidad explicar√© en la pr√≥xima secci√≥n una funci√≥n experimental que nos ayudar√° a implementar esta funcionalidad.

La mayor√≠a de funcionalidades que utilizaremos tienen un 96% de soporte de los navegadores seg√∫n la web [Can I use](https://caniuse.com/). Por otra parte, la funcionalidad importante,  `animation-timeline:scroll`, es menos soportada, pero explicaremos c√≥mo a√±adir una alternativa para navegadores que no la soportan.

As√≠ pues, empezaremos explicando que es `animation-timeline:scroll`.

## ¬øQu√© son las funciones de CSS Scroll y ScrollTimeline?

Ser√© honesto, en el momento de escribir esto iba a dar una explicaci√≥n detallada de c√≥mo funciona, pero me he dado cuenta de que todo lo que puedo decir ya est√° dicho como toca en distintas fuentes donde he encontrado esta informaci√≥n.

- [MDN Web Docs: scroll()](https://developer.mozilla.org/en-US/docs/Web/CSS/animation-timeline/scroll#browser_compatibility)

- [Animate elements on scroll with Scroll-driven animations](https://developer.chrome.com/docs/css-ui/scroll-driven-animations)

- [A case study on scroll-driven animations performance](https://developer.chrome.com/blog/scroll-animation-performance-case-study)

> A Scroll Progress Timeline is an animation timeline that is linked to progress in the scroll position of a scroll container‚Äìalso called scrollport or scroller‚Äìalong a particular axis. It converts a position in a scroll range into a percentage of progress.

Para que nos entendamos, `ScrollTimeline` permite ejecutar una animaci√≥n en funci√≥n de la posici√≥n de desplazamiento actual. Exclusivamente con CSS.

> Integrating scroll-driven animations with two existing APIs, means that they benefit from the advantages of these APIs. That includes the ability to have these animations run off the main thread. Yes, read that correctly: you can now have silky smooth animations, driven by scroll, running off the main thread, with just a few lines of extra code. What's not to like?!

Esto me explota la cabeza ü§Ø

Lo que esto significa es que esta animaci√≥n no interrumpe el hilo principal de JavaScript, adi√≥s animaciones que petardean!

Puedes comprobar el caso de estudio que he compartido antes si quieres ver una buena comparativa del rendimiento entre JavaScript tradicional en comparaci√≥n con `animation-timeline`.

## El mundo m√°gico del CSS

Pong√°monos, pues, a hacer un poquito de magia.

En el siguiente ejemplo he creado una barra de navegaci√≥n similar a la que he creado para la web de Coding Kittens. Empezar√© con el HTML b√°sico.

```html title="index.html"
... c√≥digo HTML aqu√≠
<nav class="navbar">
  <div class="backdrop"></div>
  <div class="navbar-content">
    <a href="/" class="logo-link">
      <!--Logo SVG -->
      <div class="site-name">
        <p>Your site</p>
      </div>
    </a>
    <div class="navigation-links-container">
      <div class="navigation-links">
        <a>Home</a>
        <a>Blog</a>
      </div>
    </div>
  </div>
</nav>
... m√°s c√≥digo HTML aqu√≠
```

Despu√©s, necesitaremos a√±adir algunos estilos a este elemento para que sea similar a una barra de navegaci√≥n.

```css title="styles.css"
.navbar {
  display: flex;
  position: sticky;
  padding: 1rem 0.5rem;
  margin-bottom: 3rem;
  margin-top: 5rem;
  flex-direction: row;
  align-items: flex-start;
  top: 0;

  @media (min-width: 768px) {
    padding: 1rem 1.25rem;
  }
}

.backdrop {
  position: absolute;
  top: 0;
  min-width: 100%;
  height: 5rem;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  left: -8px;
  right: -8px;

  @media (min-width: 768px) {
    margin-right: -28px;
    margin-left: -28px;
  }
}

.navbar-content {
  display: flex;
  z-index: 10;
  margin-left: 0;
  flex-direction: row;
  justify-content: space-between;
  min-width: 100%;
}

.logo-link {
  display: flex;
  flex-direction: row;
  align-items: center;
  text-decoration: none;
}

.logo {
  margin-right: 1rem;
}

.site-name {
  display: flex;
  flex-direction: column;
}

.site-name > p {
  color: white;
  margin: 0;
  font-size: 1.5rem;
  line-height: 2rem;
  font-weight: 700;

  @media (min-width: 640px) {
    font-size: 1.5rem;
    line-height: 2rem;
  }
}

.navigation-links-container {
  display: flex;
  flex-direction: row-reverse;
  gap: 1.5rem;

  @media (min-width: 640px) {
    flex-direction: row;
  }
}

.navigation-links {
  display: none;
  flex-direction: row;
  align-items: center;

  @media (min-width: 640px) {
    display: flex;
  }
}

.navigation-links a {
  position: relative;
  padding: 0.25rem 0.5rem;
}
```

Una vez tengamos todas estas piezas juntas tendremos lo siguiente:

<CodeSandbox files={getFiles({ animationStyles: false })} client:only="react"/>

Tenemos nuestra primera versi√≥n de la barra de navegaci√≥n, similar a la mencionada [al principio de esta entrada del blog](#a-bit-of-context). A√∫n no hemos a√±adido la animaci√≥n y ocupa un gran porcentaje de la pantalla. Lo podemos hacer mejor.

Aplicaremos algunos trucos de magia de CSS ü™Ñ

```css title="styles.css"
  @keyframes shrink { /* [!code focus]*//* [!code ++] */
    0% {/* [!code focus]*//* [!code ++] */
      --navbar-shrink: 0;/* [!code focus]*//* [!code ++] */
    }/* [!code focus]*//* [!code ++] */
    10%,/* [!code focus]*//* [!code ++] */
    100% {/* [!code focus]*//* [!code ++] */
      --navbar-shrink: 1;/* [!code focus]*//* [!code ++] */
    }/* [!code focus]*//* [!code ++] */
  }/* [!code focus]*//* [!code ++] */

.navbar {
    display: flex;
    position: sticky;
    padding: 1rem 0.5rem;
    margin-bottom: 3rem;
    margin-top: 5rem;
    flex-direction: row;
    align-items: flex-start;
    top: 0;
  
    @media (min-width: 768px) {
      padding: 1rem 1.25rem;
    }

    --navbar-shrink: 0; /* [!code focus]*//* [!code ++] */
    animation: shrink; /* [!code focus]*//* [!code ++] */
    animation-timing-function: ease; /* [!code focus]*//* [!code ++] */
    animation-timeline: scroll(nearest block); /* [!code focus]*//* [!code ++] */
}
```

Explicar√© paso a paso que es lo que estamos haciendo aqu√≠:

1. Primero definimos los `keyframes` de nuestra animaci√≥n. Los *keyframes* cambiar√°n una variable de CSS que hemos llamado `--navbar-shrink`. Utilizaremos ese valor como nuestro valor condicional para alternar entre la navegaci√≥n acortada o normal.

2. Seguidamente inicializamos `--navbar-shrink` a `0`

3. Despu√©s asignamos `shrink` a la animaci√≥n

4. Como *timing function* utilizaremos `ease`. Pero puedes utilizar el valor que quieras [de esta lista](https://www.w3schools.com/cssref/css3_pr_animation-timing-function.php)

5. Finalmente definimos `animation-timeline` para llamar la funci√≥n de CSS `scroll` con **nearest** como `scrollable` y **block** como `axis`.

<Callout title='Remember' type='warning'>
**`animation-timeline`** debe ser declarado despu√©s de la propiedad abreviada **`animation`**,
  ya que √©sta reiniciar√° las propiedades no incluidas y no abreviadas a su valor inicial.
</Callout>

El c√≥digo que acabamos de a√±adir nos permite utilizar la variable de CSS que utilizamos de condicional para aplicar distintos estados en nuestra barra de navegaci√≥n en funci√≥n de la posici√≥n de desplazamiento del usuario. ¬øC√≥mo te quedas?

Ahora a√±adiremos algunas animaciones interesantes:

```css title="styles.css"
... estilos de .navbar ... 

.navbar .navbar-content {
  transition: transform 0.3s ease;
  transform: translateY(calc(0px - var(--navbar-shrink) * 12px));
  /* calc(initial_position - (0 * 12 || 1 * 12))  */
}
.navbar .backdrop {
  transition: transform 0.3s ease;
  transform: translateY(calc(0px - var(--navbar-shrink) * 24px));
  /* calc(initial_position - (0 * 24 || 1 * 24))  */
}

.navbar .logo {
  transition: transform 0.3s ease;
  transform: scale(calc(1 - var(--navbar-shrink) * 0.2));
  /* calc(initial_scale - (0 * 0.2 || 1 * 0.2))  */
}

.navbar p {
  transition: opacity 0.3s ease;
  opacity: calc(1 - var(--navbar-shrink));
  /* calc(initial_opacity - (0 || 1))  */
}
... m√°s estilos ...
```

Como podemos ver utilizamos la variable `--navbar-shrink` para calcular din√°micamente el valor utilizando la funci√≥n de CSS `calc`. Esto es lo que est√° haciendo:

- Mover el *navbar-content* y el *backdrop* varios p√≠xeles fuera de la pantalla.

- Reducir el tama√±o del *logo*

- Reducir la opacidad del texto

Este c√≥digo puede extenderse para incluir todas las transiciones que queramos.

F√≠jate en c√≥mo he utilizado `scale`, `opacity` y `translateY` ‚Äã‚Äãpara [aprovechar la animaci√≥n compuesta](https://web.dev/articles/animations-guide#triggers).

## Alternativa para aquellos que utilizan navegadores antiguos

Como he mencionado al principio de esta entrada, la propiedad de CSS `animation-timeline` todav√≠a no est√° soportada en todos los navegadores. De hecho, en enero de 2024 solamente los navegadores Chromium y Firfeox (haciendo uso de una opci√≥n de configuraci√≥n experimental) soportan esta propiedad.

No tengas miedo, tengo la soluci√≥n ideal para ti. Haremos algunos cambios en nuestro CSS y a√±adiremos algo de JavaScript.

Comenzaremos a√±adiendo la regla "CSS `@supports`" para comprobar si el navegador soporta la funci√≥n `scroll()`.

```css title="styles.css"
.navbar {
  display: flex;
  position: sticky;
  padding: 1rem 0.5rem;
  margin-bottom: 3rem;
  margin-top: 5rem;
  flex-direction: row;
  align-items: flex-start;
  top: 0;

  @media (min-width: 768px) {
    padding: 1rem 1.25rem;
  } 

   --navbar-shrink: 0;/* [!code --] *//* [!code focus]*/
  /* [!code --] *//* [!code focus]*/
    animation: shrink;/* [!code --] *//* [!code focus]*/
    animation-timeline: scroll(nearest block);/* [!code --] *//* [!code focus]*/
    animation-timing-function: ease;/* [!code --] *//* [!code focus]*/
}

  @supports (animation-timeline: scroll()) {/* [!code ++] *//* [!code focus]*/
    .navbar {/* [!code ++] *//* [!code focus]*/
      --navbar-shrink: 0;/* [!code ++] *//* [!code focus]*/
      /* [!code ++] *//* [!code focus]*/
      animation: shrink;/* [!code ++] *//* [!code focus]*/
      animation-timeline: scroll(nearest block);/* [!code ++] *//* [!code focus]*/
      animation-timing-function: ease;/* [!code ++] *//* [!code focus]*/
    }/* [!code ++] *//* [!code focus]*/
  }/* [!code ++] *//* [!code focus]*/
    
```

A continuaci√≥n, si no hay soporte, necesitamos alternar la variable `--navbar-shrink` de todos modos, ya que a√∫n necesitamos cambiar los estilos de forma din√°mica a los elementos de la barra de
navegaci√≥n.

A√±adiremos un poco de JavaScript debajo de nuestro elemento `nav` para que sea ejecutado despu√©s de que el elemento sea renderizado en la p√°gina. Idealmente, tambi√©n se puede a√±adir justo antes del cierre de la etiqueta `</body>`.

```html title="index.html" {23, 36, 38}
... html code here
<nav class="navbar">
  <div class="backdrop"></div>
  <div class="inner-container">
    <a href="/" class="logo-link">
      <!--Logo SVG -->       
      <div class="site-name">
        <p>Your site</p>
      </div>
    </a>
    <div class="navigation-links">
      <div class="navigation-links-inner">
        <a>Home</a>
        <a>Blog</a>
      </div>
    </div>
  </div>
</nav>
<script>/* [!code focus]*/
  (function () {/* [!code focus]*/
    const navbar = document.querySelector(".navbar");/* [!code focus]*/

    if (!CSS.supports("animation-timeline: scroll()")) {/* [!code focus]*/
      const threshold = 500; // Adjust this threshold as needed/* [!code focus]*/

      window.addEventListener("scroll", handleScroll);/* [!code focus]*/

      function handleScroll() {/* [!code focus]*/
        if (!navbar) {/* [!code focus]*/
          return;/* [!code focus]*/
        }/* [!code focus]*/

        const scrollY = window.scrollY || window.pageYOffset;/* [!code focus]*/

        if (scrollY > threshold) {/* [!code focus]*/
          navbar.style.setProperty("--navbar-shrink", "1");/* [!code focus]*/
        } else {/* [!code focus]*/
          navbar.style.setProperty("--navbar-shrink", "0");/* [!code focus]*/
        }/* [!code focus]*/
      }/* [!code focus]*/
    }/* [!code focus]*/
  })();/* [!code focus]*/
</script>/* [!code focus]*/
... m√°s c√≥digo HTML
```

Este c√≥digo ejecuta la implementaci√≥n que os he mostrado [al principio de esta entrada](#implementaci√≥n-aburrida).

Si quieres, puedes comprobar el resultado de los cambios que hemos aplicado en el siguiente *Code Sandbox*:

<CodeSandbox files={
  getFiles({ animationStyles: true })
} client:only="react"/>

!Esto es todo, amigos! ü•ï

Hemos a√±adido algunas pinceladas de buen gusto a la UX para mejorar la experiencia de los usuarios que utilizan dispositivos con pantallas peque√±as aplicando una animaci√≥n en la barra de navegaci√≥n que tiene mejor rendimiento que la variante tradicional, es m√°s extensible y utiliza CSS. Tambi√©n hemos a√±adido una alternativa para aquellos usuarios que utilizan navegadores no compatibles.

Te animo a experimentar con el Code Sandbox a√±adiendo m√°s keyframes, m√°s variables de CSS y en definitiva m√°s variaciones.

Espero que hayas disfrutado de esta entrada. ¬°Hasta pronto! üòÑ